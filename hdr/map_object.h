#ifndef __MAP_OBJECT_H
#define __MAP_OBJECT_H

#include <stdlib.h>
#include <stdint.h>
#include "vertex.h"
#include "sprite_animation.h"
#include "camera.h"
#include "map_object_projection.h"
#include "clipped_segment_projections.h"

// FIXME: make these unique
#define MF_COUNTITEM	0x00000001
#define MF_COUNTKILL	0x00000001
#define MF_DROPOFF	0x00000001
#define MF_FLOAT	0x00000001
#define MF_MISSILE	0x00000001
#define MF_NOBLOCKMAP	0x00000001
#define MF_NOBLOOD	0x00000001
#define MF_NOCLIP	0x00000001
#define MF_NOGRAVITY	0x00000001
#define MF_NOSECTOR	0x00000001
#define MF_NOTDMATCH	0x00000001
#define MF_PICKUP	0x00000001
#define MF_SHADOW	0x00000001
#define MF_SHOOTABLE	0x00000001
#define MF_SOLID	0x00000001
#define MF_SPAWNCEILING	0x00000001
#define MF_SPECIAL	0x00000001

enum map_obj_state_id
{
STATE_NULL,

STATE_AMMO,
STATE_ARACH_PLAZ,
STATE_ARACH_PLAZ2,
STATE_ARACH_PLEX,
STATE_ARACH_PLEX2,
STATE_ARACH_PLEX3,
STATE_ARACH_PLEX4,
STATE_ARACH_PLEX5,
STATE_ARM1,
STATE_ARM1A,
STATE_ARM2,
STATE_ARM2A,
STATE_BAR1,
STATE_BAR2,
STATE_BBAR1,
STATE_BBAR2,
STATE_BBAR3,
STATE_BEXP,
STATE_BEXP2,
STATE_BEXP3,
STATE_BEXP4,
STATE_BEXP5,
STATE_BFG,
STATE_BFG1,
STATE_BFG2,
STATE_BFG3,
STATE_BFG4,
STATE_BFGDOWN,
STATE_BFGEXP,
STATE_BFGEXP2,
STATE_BFGEXP3,
STATE_BFGEXP4,
STATE_BFGFLASH1,
STATE_BFGFLASH2,
STATE_BFGLAND,
STATE_BFGLAND2,
STATE_BFGLAND3,
STATE_BFGLAND4,
STATE_BFGLAND5,
STATE_BFGLAND6,
STATE_BFGSHOT,
STATE_BFGSHOT2,
STATE_BFGUP,
STATE_BFUG,
STATE_BIGTREE,
STATE_BKEY,
STATE_BKEY2,
STATE_BLOOD1,
STATE_BLOOD2,
STATE_BLOOD3,
STATE_BLOODYTWITCH,
STATE_BLOODYTWITCH2,
STATE_BLOODYTWITCH3,
STATE_BLOODYTWITCH4,
STATE_BLUETORCH,
STATE_BLUETORCH2,
STATE_BLUETORCH3,
STATE_BLUETORCH4,
STATE_BON1,
STATE_BON1A,
STATE_BON1B,
STATE_BON1C,
STATE_BON1D,
STATE_BON1E,
STATE_BON2,
STATE_BON2A,
STATE_BON2B,
STATE_BON2C,
STATE_BON2D,
STATE_BON2E,
STATE_BOS2_ATK1,
STATE_BOS2_ATK2,
STATE_BOS2_ATK3,
STATE_BOS2_DIE1,
STATE_BOS2_DIE2,
STATE_BOS2_DIE3,
STATE_BOS2_DIE4,
STATE_BOS2_DIE5,
STATE_BOS2_DIE6,
STATE_BOS2_DIE7,
STATE_BOS2_PAIN,
STATE_BOS2_PAIN2,
STATE_BOS2_RAISE1,
STATE_BOS2_RAISE2,
STATE_BOS2_RAISE3,
STATE_BOS2_RAISE4,
STATE_BOS2_RAISE5,
STATE_BOS2_RAISE6,
STATE_BOS2_RAISE7,
STATE_BOS2_RUN1,
STATE_BOS2_RUN2,
STATE_BOS2_RUN3,
STATE_BOS2_RUN4,
STATE_BOS2_RUN5,
STATE_BOS2_RUN6,
STATE_BOS2_RUN7,
STATE_BOS2_RUN8,
STATE_BOS2_STND,
STATE_BOS2_STND2,
STATE_BOSS_ATK1,
STATE_BOSS_ATK2,
STATE_BOSS_ATK3,
STATE_BOSS_DIE1,
STATE_BOSS_DIE2,
STATE_BOSS_DIE3,
STATE_BOSS_DIE4,
STATE_BOSS_DIE5,
STATE_BOSS_DIE6,
STATE_BOSS_DIE7,
STATE_BOSS_PAIN,
STATE_BOSS_PAIN2,
STATE_BOSS_RAISE1,
STATE_BOSS_RAISE2,
STATE_BOSS_RAISE3,
STATE_BOSS_RAISE4,
STATE_BOSS_RAISE5,
STATE_BOSS_RAISE6,
STATE_BOSS_RAISE7,
STATE_BOSS_RUN1,
STATE_BOSS_RUN2,
STATE_BOSS_RUN3,
STATE_BOSS_RUN4,
STATE_BOSS_RUN5,
STATE_BOSS_RUN6,
STATE_BOSS_RUN7,
STATE_BOSS_RUN8,
STATE_BOSS_STND,
STATE_BOSS_STND2,
STATE_BPAK,
STATE_BRAIN,
STATE_BRAINEXPLODE1,
STATE_BRAINEXPLODE2,
STATE_BRAINEXPLODE3,
STATE_BRAINEYE,
STATE_BRAINEYE1,
STATE_BRAINEYESEE,
STATE_BRAINSTEM,
STATE_BRAIN_DIE1,
STATE_BRAIN_DIE2,
STATE_BRAIN_DIE3,
STATE_BRAIN_DIE4,
STATE_BRAIN_PAIN,
STATE_BRBALL1,
STATE_BRBALL2,
STATE_BRBALLX1,
STATE_BRBALLX2,
STATE_BRBALLX3,
STATE_BROK,
STATE_BSKULL,
STATE_BSKULL2,
STATE_BSPI_ATK1,
STATE_BSPI_ATK2,
STATE_BSPI_ATK3,
STATE_BSPI_ATK4,
STATE_BSPI_DIE1,
STATE_BSPI_DIE2,
STATE_BSPI_DIE3,
STATE_BSPI_DIE4,
STATE_BSPI_DIE5,
STATE_BSPI_DIE6,
STATE_BSPI_DIE7,
STATE_BSPI_PAIN,
STATE_BSPI_PAIN2,
STATE_BSPI_RAISE1,
STATE_BSPI_RAISE2,
STATE_BSPI_RAISE3,
STATE_BSPI_RAISE4,
STATE_BSPI_RAISE5,
STATE_BSPI_RAISE6,
STATE_BSPI_RAISE7,
STATE_BSPI_RUN1,
STATE_BSPI_RUN10,
STATE_BSPI_RUN11,
STATE_BSPI_RUN12,
STATE_BSPI_RUN2,
STATE_BSPI_RUN3,
STATE_BSPI_RUN4,
STATE_BSPI_RUN5,
STATE_BSPI_RUN6,
STATE_BSPI_RUN7,
STATE_BSPI_RUN8,
STATE_BSPI_RUN9,
STATE_BSPI_SIGHT,
STATE_BSPI_STND,
STATE_BSPI_STND2,
STATE_BTORCHSHRT,
STATE_BTORCHSHRT2,
STATE_BTORCHSHRT3,
STATE_BTORCHSHRT4,
STATE_CANDELABRA,
STATE_CANDLESTIK,
STATE_CELL,
STATE_CELP,
STATE_CHAIN,
STATE_CHAIN1,
STATE_CHAIN2,
STATE_CHAIN3,
STATE_CHAINDOWN,
STATE_CHAINFLASH1,
STATE_CHAINFLASH2,
STATE_CHAINUP,
STATE_CLIP,
STATE_COLONGIBS,
STATE_COLU,
STATE_COMMKEEN,
STATE_COMMKEEN10,
STATE_COMMKEEN11,
STATE_COMMKEEN12,
STATE_COMMKEEN2,
STATE_COMMKEEN3,
STATE_COMMKEEN4,
STATE_COMMKEEN5,
STATE_COMMKEEN6,
STATE_COMMKEEN7,
STATE_COMMKEEN8,
STATE_COMMKEEN9,
STATE_CPOS_ATK1,
STATE_CPOS_ATK2,
STATE_CPOS_ATK3,
STATE_CPOS_ATK4,
STATE_CPOS_DIE1,
STATE_CPOS_DIE2,
STATE_CPOS_DIE3,
STATE_CPOS_DIE4,
STATE_CPOS_DIE5,
STATE_CPOS_DIE6,
STATE_CPOS_DIE7,
STATE_CPOS_PAIN,
STATE_CPOS_PAIN2,
STATE_CPOS_RAISE1,
STATE_CPOS_RAISE2,
STATE_CPOS_RAISE3,
STATE_CPOS_RAISE4,
STATE_CPOS_RAISE5,
STATE_CPOS_RAISE6,
STATE_CPOS_RAISE7,
STATE_CPOS_RUN1,
STATE_CPOS_RUN2,
STATE_CPOS_RUN3,
STATE_CPOS_RUN4,
STATE_CPOS_RUN5,
STATE_CPOS_RUN6,
STATE_CPOS_RUN7,
STATE_CPOS_RUN8,
STATE_CPOS_STND,
STATE_CPOS_STND2,
STATE_CPOS_XDIE1,
STATE_CPOS_XDIE2,
STATE_CPOS_XDIE3,
STATE_CPOS_XDIE4,
STATE_CPOS_XDIE5,
STATE_CPOS_XDIE6,
STATE_CSAW,
STATE_CYBER_ATK1,
STATE_CYBER_ATK2,
STATE_CYBER_ATK3,
STATE_CYBER_ATK4,
STATE_CYBER_ATK5,
STATE_CYBER_ATK6,
STATE_CYBER_DIE1,
STATE_CYBER_DIE10,
STATE_CYBER_DIE2,
STATE_CYBER_DIE3,
STATE_CYBER_DIE4,
STATE_CYBER_DIE5,
STATE_CYBER_DIE6,
STATE_CYBER_DIE7,
STATE_CYBER_DIE8,
STATE_CYBER_DIE9,
STATE_CYBER_PAIN,
STATE_CYBER_RUN1,
STATE_CYBER_RUN2,
STATE_CYBER_RUN3,
STATE_CYBER_RUN4,
STATE_CYBER_RUN5,
STATE_CYBER_RUN6,
STATE_CYBER_RUN7,
STATE_CYBER_RUN8,
STATE_CYBER_STND,
STATE_CYBER_STND2,
STATE_DEADBOTTOM,
STATE_DEADSTICK,
STATE_DEADTORSO,
STATE_DSGUN,
STATE_DSGUN1,
STATE_DSGUN10,
STATE_DSGUN2,
STATE_DSGUN3,
STATE_DSGUN4,
STATE_DSGUN5,
STATE_DSGUN6,
STATE_DSGUN7,
STATE_DSGUN8,
STATE_DSGUN9,
STATE_DSGUNDOWN,
STATE_DSGUNFLASH1,
STATE_DSGUNFLASH2,
STATE_DSGUNUP,
STATE_DSNR1,
STATE_DSNR2,
STATE_EVILEYE,
STATE_EVILEYE2,
STATE_EVILEYE3,
STATE_EVILEYE4,
STATE_EXPLODE1,
STATE_EXPLODE2,
STATE_EXPLODE3,
STATE_FATSHOT1,
STATE_FATSHOT2,
STATE_FATSHOTX1,
STATE_FATSHOTX2,
STATE_FATSHOTX3,
STATE_FATT_ATK1,
STATE_FATT_ATK10,
STATE_FATT_ATK2,
STATE_FATT_ATK3,
STATE_FATT_ATK4,
STATE_FATT_ATK5,
STATE_FATT_ATK6,
STATE_FATT_ATK7,
STATE_FATT_ATK8,
STATE_FATT_ATK9,
STATE_FATT_DIE1,
STATE_FATT_DIE10,
STATE_FATT_DIE2,
STATE_FATT_DIE3,
STATE_FATT_DIE4,
STATE_FATT_DIE5,
STATE_FATT_DIE6,
STATE_FATT_DIE7,
STATE_FATT_DIE8,
STATE_FATT_DIE9,
STATE_FATT_PAIN,
STATE_FATT_PAIN2,
STATE_FATT_RAISE1,
STATE_FATT_RAISE2,
STATE_FATT_RAISE3,
STATE_FATT_RAISE4,
STATE_FATT_RAISE5,
STATE_FATT_RAISE6,
STATE_FATT_RAISE7,
STATE_FATT_RAISE8,
STATE_FATT_RUN1,
STATE_FATT_RUN10,
STATE_FATT_RUN11,
STATE_FATT_RUN12,
STATE_FATT_RUN2,
STATE_FATT_RUN3,
STATE_FATT_RUN4,
STATE_FATT_RUN5,
STATE_FATT_RUN6,
STATE_FATT_RUN7,
STATE_FATT_RUN8,
STATE_FATT_RUN9,
STATE_FATT_STND,
STATE_FATT_STND2,
STATE_FIRE1,
STATE_FIRE10,
STATE_FIRE11,
STATE_FIRE12,
STATE_FIRE13,
STATE_FIRE14,
STATE_FIRE15,
STATE_FIRE16,
STATE_FIRE17,
STATE_FIRE18,
STATE_FIRE19,
STATE_FIRE2,
STATE_FIRE20,
STATE_FIRE21,
STATE_FIRE22,
STATE_FIRE23,
STATE_FIRE24,
STATE_FIRE25,
STATE_FIRE26,
STATE_FIRE27,
STATE_FIRE28,
STATE_FIRE29,
STATE_FIRE3,
STATE_FIRE30,
STATE_FIRE4,
STATE_FIRE5,
STATE_FIRE6,
STATE_FIRE7,
STATE_FIRE8,
STATE_FIRE9,
STATE_FLOATSKULL,
STATE_FLOATSKULL2,
STATE_FLOATSKULL3,
STATE_GIBS,
STATE_GREENTORCH,
STATE_GREENTORCH2,
STATE_GREENTORCH3,
STATE_GREENTORCH4,
STATE_GTORCHSHRT,
STATE_GTORCHSHRT2,
STATE_GTORCHSHRT3,
STATE_GTORCHSHRT4,
STATE_HANGBNOBRAIN,
STATE_HANGNOGUTS,
STATE_HANGTLOOKDN,
STATE_HANGTLOOKUP,
STATE_HANGTNOBRAIN,
STATE_HANGTSKULL,
STATE_HEADCANDLES,
STATE_HEADCANDLES2,
STATE_HEADONASTICK,
STATE_HEADSONSTICK,
STATE_HEAD_ATK1,
STATE_HEAD_ATK2,
STATE_HEAD_ATK3,
STATE_HEAD_DIE1,
STATE_HEAD_DIE2,
STATE_HEAD_DIE3,
STATE_HEAD_DIE4,
STATE_HEAD_DIE5,
STATE_HEAD_DIE6,
STATE_HEAD_PAIN,
STATE_HEAD_PAIN2,
STATE_HEAD_PAIN3,
STATE_HEAD_RAISE1,
STATE_HEAD_RAISE2,
STATE_HEAD_RAISE3,
STATE_HEAD_RAISE4,
STATE_HEAD_RAISE5,
STATE_HEAD_RAISE6,
STATE_HEAD_RUN1,
STATE_HEAD_STND,
STATE_HEARTCOL,
STATE_HEARTCOL2,
STATE_IFOG,
STATE_IFOG01,
STATE_IFOG02,
STATE_IFOG2,
STATE_IFOG3,
STATE_IFOG4,
STATE_IFOG5,
STATE_KEENPAIN,
STATE_KEENPAIN2,
STATE_KEENSTND,
STATE_LAUN,
STATE_LIGHTDONE,
STATE_LIVESTICK,
STATE_LIVESTICK2,
STATE_MEAT2,
STATE_MEAT3,
STATE_MEAT4,
STATE_MEAT5,
STATE_MEDI,
STATE_MEGA,
STATE_MEGA2,
STATE_MEGA3,
STATE_MEGA4,
STATE_MGUN,
STATE_MISSILE,
STATE_MISSILE1,
STATE_MISSILE2,
STATE_MISSILE3,
STATE_MISSILEDOWN,
STATE_MISSILEFLASH1,
STATE_MISSILEFLASH2,
STATE_MISSILEFLASH3,
STATE_MISSILEFLASH4,
STATE_MISSILEUP,
STATE_PAIN_ATK1,
STATE_PAIN_ATK2,
STATE_PAIN_ATK3,
STATE_PAIN_ATK4,
STATE_PAIN_DIE1,
STATE_PAIN_DIE2,
STATE_PAIN_DIE3,
STATE_PAIN_DIE4,
STATE_PAIN_DIE5,
STATE_PAIN_DIE6,
STATE_PAIN_PAIN,
STATE_PAIN_PAIN2,
STATE_PAIN_RAISE1,
STATE_PAIN_RAISE2,
STATE_PAIN_RAISE3,
STATE_PAIN_RAISE4,
STATE_PAIN_RAISE5,
STATE_PAIN_RAISE6,
STATE_PAIN_RUN1,
STATE_PAIN_RUN2,
STATE_PAIN_RUN3,
STATE_PAIN_RUN4,
STATE_PAIN_RUN5,
STATE_PAIN_RUN6,
STATE_PAIN_STND,
STATE_PINS,
STATE_PINS2,
STATE_PINS3,
STATE_PINS4,
STATE_PINV,
STATE_PINV2,
STATE_PINV3,
STATE_PINV4,
STATE_PISTOL,
STATE_PISTOL1,
STATE_PISTOL2,
STATE_PISTOL3,
STATE_PISTOL4,
STATE_PISTOLDOWN,
STATE_PISTOLFLASH,
STATE_PISTOLUP,
STATE_PLAS,
STATE_PLASBALL,
STATE_PLASBALL2,
STATE_PLASEXP,
STATE_PLASEXP2,
STATE_PLASEXP3,
STATE_PLASEXP4,
STATE_PLASEXP5,
STATE_PLASMA,
STATE_PLASMA1,
STATE_PLASMA2,
STATE_PLASMADOWN,
STATE_PLASMAFLASH1,
STATE_PLASMAFLASH2,
STATE_PLASMAUP,
STATE_PLAY,
STATE_PLAY_ATK1,
STATE_PLAY_ATK2,
STATE_PLAY_DIE1,
STATE_PLAY_DIE2,
STATE_PLAY_DIE3,
STATE_PLAY_DIE4,
STATE_PLAY_DIE5,
STATE_PLAY_DIE6,
STATE_PLAY_DIE7,
STATE_PLAY_PAIN,
STATE_PLAY_PAIN2,
STATE_PLAY_RUN1,
STATE_PLAY_RUN2,
STATE_PLAY_RUN3,
STATE_PLAY_RUN4,
STATE_PLAY_XDIE1,
STATE_PLAY_XDIE2,
STATE_PLAY_XDIE3,
STATE_PLAY_XDIE4,
STATE_PLAY_XDIE5,
STATE_PLAY_XDIE6,
STATE_PLAY_XDIE7,
STATE_PLAY_XDIE8,
STATE_PLAY_XDIE9,
STATE_PMAP,
STATE_PMAP2,
STATE_PMAP3,
STATE_PMAP4,
STATE_PMAP5,
STATE_PMAP6,
STATE_POSS_ATK1,
STATE_POSS_ATK2,
STATE_POSS_ATK3,
STATE_POSS_DIE1,
STATE_POSS_DIE2,
STATE_POSS_DIE3,
STATE_POSS_DIE4,
STATE_POSS_DIE5,
STATE_POSS_PAIN,
STATE_POSS_PAIN2,
STATE_POSS_RAISE1,
STATE_POSS_RAISE2,
STATE_POSS_RAISE3,
STATE_POSS_RAISE4,
STATE_POSS_RUN1,
STATE_POSS_RUN2,
STATE_POSS_RUN3,
STATE_POSS_RUN4,
STATE_POSS_RUN5,
STATE_POSS_RUN6,
STATE_POSS_RUN7,
STATE_POSS_RUN8,
STATE_POSS_STND,
STATE_POSS_STND2,
STATE_POSS_XDIE1,
STATE_POSS_XDIE2,
STATE_POSS_XDIE3,
STATE_POSS_XDIE4,
STATE_POSS_XDIE5,
STATE_POSS_XDIE6,
STATE_POSS_XDIE7,
STATE_POSS_XDIE8,
STATE_POSS_XDIE9,
STATE_PSTR,
STATE_PUFF1,
STATE_PUFF2,
STATE_PUFF3,
STATE_PUFF4,
STATE_PUNCH,
STATE_PUNCH1,
STATE_PUNCH2,
STATE_PUNCH3,
STATE_PUNCH4,
STATE_PUNCH5,
STATE_PUNCHDOWN,
STATE_PUNCHUP,
STATE_PVIS,
STATE_PVIS2,
STATE_RBALL1,
STATE_RBALL2,
STATE_RBALLX1,
STATE_RBALLX2,
STATE_RBALLX3,
STATE_REDTORCH,
STATE_REDTORCH2,
STATE_REDTORCH3,
STATE_REDTORCH4,
STATE_RKEY,
STATE_RKEY2,
STATE_ROCK,
STATE_ROCKET,
STATE_RSKULL,
STATE_RSKULL2,
STATE_RTORCHSHRT,
STATE_RTORCHSHRT2,
STATE_RTORCHSHRT3,
STATE_RTORCHSHRT4,
STATE_SARG_ATK1,
STATE_SARG_ATK2,
STATE_SARG_ATK3,
STATE_SARG_DIE1,
STATE_SARG_DIE2,
STATE_SARG_DIE3,
STATE_SARG_DIE4,
STATE_SARG_DIE5,
STATE_SARG_DIE6,
STATE_SARG_PAIN,
STATE_SARG_PAIN2,
STATE_SARG_RAISE1,
STATE_SARG_RAISE2,
STATE_SARG_RAISE3,
STATE_SARG_RAISE4,
STATE_SARG_RAISE5,
STATE_SARG_RAISE6,
STATE_SARG_RUN1,
STATE_SARG_RUN2,
STATE_SARG_RUN3,
STATE_SARG_RUN4,
STATE_SARG_RUN5,
STATE_SARG_RUN6,
STATE_SARG_RUN7,
STATE_SARG_RUN8,
STATE_SARG_STND,
STATE_SARG_STND2,
STATE_SAW,
STATE_SAW1,
STATE_SAW2,
STATE_SAW3,
STATE_SAWB,
STATE_SAWDOWN,
STATE_SAWUP,
STATE_SBOX,
STATE_SGUN,
STATE_SGUN1,
STATE_SGUN2,
STATE_SGUN3,
STATE_SGUN4,
STATE_SGUN5,
STATE_SGUN6,
STATE_SGUN7,
STATE_SGUN8,
STATE_SGUN9,
STATE_SGUNDOWN,
STATE_SGUNFLASH1,
STATE_SGUNFLASH2,
STATE_SGUNUP,
STATE_SHEL,
STATE_SHOT,
STATE_SHOT2,
STATE_SHRTGRNCOL,
STATE_SHRTREDCOL,
STATE_SKEL_DIE1,
STATE_SKEL_DIE2,
STATE_SKEL_DIE3,
STATE_SKEL_DIE4,
STATE_SKEL_DIE5,
STATE_SKEL_DIE6,
STATE_SKEL_FIST1,
STATE_SKEL_FIST2,
STATE_SKEL_FIST3,
STATE_SKEL_FIST4,
STATE_SKEL_MISS1,
STATE_SKEL_MISS2,
STATE_SKEL_MISS3,
STATE_SKEL_MISS4,
STATE_SKEL_PAIN,
STATE_SKEL_PAIN2,
STATE_SKEL_RAISE1,
STATE_SKEL_RAISE2,
STATE_SKEL_RAISE3,
STATE_SKEL_RAISE4,
STATE_SKEL_RAISE5,
STATE_SKEL_RAISE6,
STATE_SKEL_RUN1,
STATE_SKEL_RUN10,
STATE_SKEL_RUN11,
STATE_SKEL_RUN12,
STATE_SKEL_RUN2,
STATE_SKEL_RUN3,
STATE_SKEL_RUN4,
STATE_SKEL_RUN5,
STATE_SKEL_RUN6,
STATE_SKEL_RUN7,
STATE_SKEL_RUN8,
STATE_SKEL_RUN9,
STATE_SKEL_STND,
STATE_SKEL_STND2,
STATE_SKULLCOL,
STATE_SKULL_ATK1,
STATE_SKULL_ATK2,
STATE_SKULL_ATK3,
STATE_SKULL_ATK4,
STATE_SKULL_DIE1,
STATE_SKULL_DIE2,
STATE_SKULL_DIE3,
STATE_SKULL_DIE4,
STATE_SKULL_DIE5,
STATE_SKULL_DIE6,
STATE_SKULL_PAIN,
STATE_SKULL_PAIN2,
STATE_SKULL_RUN1,
STATE_SKULL_RUN2,
STATE_SKULL_STND,
STATE_SKULL_STND2,
STATE_SMALLPOOL,
STATE_SMOKE1,
STATE_SMOKE2,
STATE_SMOKE3,
STATE_SMOKE4,
STATE_SMOKE5,
STATE_SOUL,
STATE_SOUL2,
STATE_SOUL3,
STATE_SOUL4,
STATE_SOUL5,
STATE_SOUL6,
STATE_SPAWN1,
STATE_SPAWN2,
STATE_SPAWN3,
STATE_SPAWN4,
STATE_SPAWNFIRE1,
STATE_SPAWNFIRE2,
STATE_SPAWNFIRE3,
STATE_SPAWNFIRE4,
STATE_SPAWNFIRE5,
STATE_SPAWNFIRE6,
STATE_SPAWNFIRE7,
STATE_SPAWNFIRE8,
STATE_SPID_ATK1,
STATE_SPID_ATK2,
STATE_SPID_ATK3,
STATE_SPID_ATK4,
STATE_SPID_DIE1,
STATE_SPID_DIE10,
STATE_SPID_DIE11,
STATE_SPID_DIE2,
STATE_SPID_DIE3,
STATE_SPID_DIE4,
STATE_SPID_DIE5,
STATE_SPID_DIE6,
STATE_SPID_DIE7,
STATE_SPID_DIE8,
STATE_SPID_DIE9,
STATE_SPID_PAIN,
STATE_SPID_PAIN2,
STATE_SPID_RUN1,
STATE_SPID_RUN10,
STATE_SPID_RUN11,
STATE_SPID_RUN12,
STATE_SPID_RUN2,
STATE_SPID_RUN3,
STATE_SPID_RUN4,
STATE_SPID_RUN5,
STATE_SPID_RUN6,
STATE_SPID_RUN7,
STATE_SPID_RUN8,
STATE_SPID_RUN9,
STATE_SPID_STND,
STATE_SPID_STND2,
STATE_SPOS_ATK1,
STATE_SPOS_ATK2,
STATE_SPOS_ATK3,
STATE_SPOS_DIE1,
STATE_SPOS_DIE2,
STATE_SPOS_DIE3,
STATE_SPOS_DIE4,
STATE_SPOS_DIE5,
STATE_SPOS_PAIN,
STATE_SPOS_PAIN2,
STATE_SPOS_RAISE1,
STATE_SPOS_RAISE2,
STATE_SPOS_RAISE3,
STATE_SPOS_RAISE4,
STATE_SPOS_RAISE5,
STATE_SPOS_RUN1,
STATE_SPOS_RUN2,
STATE_SPOS_RUN3,
STATE_SPOS_RUN4,
STATE_SPOS_RUN5,
STATE_SPOS_RUN6,
STATE_SPOS_RUN7,
STATE_SPOS_RUN8,
STATE_SPOS_STND,
STATE_SPOS_STND2,
STATE_SPOS_XDIE1,
STATE_SPOS_XDIE2,
STATE_SPOS_XDIE3,
STATE_SPOS_XDIE4,
STATE_SPOS_XDIE5,
STATE_SPOS_XDIE6,
STATE_SPOS_XDIE7,
STATE_SPOS_XDIE8,
STATE_SPOS_XDIE9,
STATE_SSWV_ATK1,
STATE_SSWV_ATK2,
STATE_SSWV_ATK3,
STATE_SSWV_ATK4,
STATE_SSWV_ATK5,
STATE_SSWV_ATK6,
STATE_SSWV_DIE1,
STATE_SSWV_DIE2,
STATE_SSWV_DIE3,
STATE_SSWV_DIE4,
STATE_SSWV_DIE5,
STATE_SSWV_PAIN,
STATE_SSWV_PAIN2,
STATE_SSWV_RAISE1,
STATE_SSWV_RAISE2,
STATE_SSWV_RAISE3,
STATE_SSWV_RAISE4,
STATE_SSWV_RAISE5,
STATE_SSWV_RUN1,
STATE_SSWV_RUN2,
STATE_SSWV_RUN3,
STATE_SSWV_RUN4,
STATE_SSWV_RUN5,
STATE_SSWV_RUN6,
STATE_SSWV_RUN7,
STATE_SSWV_RUN8,
STATE_SSWV_STND,
STATE_SSWV_STND2,
STATE_SSWV_XDIE1,
STATE_SSWV_XDIE2,
STATE_SSWV_XDIE3,
STATE_SSWV_XDIE4,
STATE_SSWV_XDIE5,
STATE_SSWV_XDIE6,
STATE_SSWV_XDIE7,
STATE_SSWV_XDIE8,
STATE_SSWV_XDIE9,
STATE_STALAG,
STATE_STALAGTITE,
STATE_STIM,
STATE_SUIT,
STATE_TALLGRNCOL,
STATE_TALLREDCOL,
STATE_TBALL1,
STATE_TBALL2,
STATE_TBALLX1,
STATE_TBALLX2,
STATE_TBALLX3,
STATE_TECH2LAMP,
STATE_TECH2LAMP2,
STATE_TECH2LAMP3,
STATE_TECH2LAMP4,
STATE_TECHLAMP,
STATE_TECHLAMP2,
STATE_TECHLAMP3,
STATE_TECHLAMP4,
STATE_TECHPILLAR,
STATE_TFOG,
STATE_TFOG01,
STATE_TFOG02,
STATE_TFOG10,
STATE_TFOG2,
STATE_TFOG3,
STATE_TFOG4,
STATE_TFOG5,
STATE_TFOG6,
STATE_TFOG7,
STATE_TFOG8,
STATE_TFOG9,
STATE_TORCHTREE,
STATE_TRACEEXP1,
STATE_TRACEEXP2,
STATE_TRACEEXP3,
STATE_TRACER,
STATE_TRACER2,
STATE_TROO_ATK1,
STATE_TROO_ATK2,
STATE_TROO_ATK3,
STATE_TROO_DIE1,
STATE_TROO_DIE2,
STATE_TROO_DIE3,
STATE_TROO_DIE4,
STATE_TROO_DIE5,
STATE_TROO_PAIN,
STATE_TROO_PAIN2,
STATE_TROO_RAISE1,
STATE_TROO_RAISE2,
STATE_TROO_RAISE3,
STATE_TROO_RAISE4,
STATE_TROO_RAISE5,
STATE_TROO_RUN1,
STATE_TROO_RUN2,
STATE_TROO_RUN3,
STATE_TROO_RUN4,
STATE_TROO_RUN5,
STATE_TROO_RUN6,
STATE_TROO_RUN7,
STATE_TROO_RUN8,
STATE_TROO_STND,
STATE_TROO_STND2,
STATE_TROO_XDIE1,
STATE_TROO_XDIE2,
STATE_TROO_XDIE3,
STATE_TROO_XDIE4,
STATE_TROO_XDIE5,
STATE_TROO_XDIE6,
STATE_TROO_XDIE7,
STATE_TROO_XDIE8,
STATE_VILE_ATK1,
STATE_VILE_ATK10,
STATE_VILE_ATK11,
STATE_VILE_ATK2,
STATE_VILE_ATK3,
STATE_VILE_ATK4,
STATE_VILE_ATK5,
STATE_VILE_ATK6,
STATE_VILE_ATK7,
STATE_VILE_ATK8,
STATE_VILE_ATK9,
STATE_VILE_DIE1,
STATE_VILE_DIE10,
STATE_VILE_DIE2,
STATE_VILE_DIE3,
STATE_VILE_DIE4,
STATE_VILE_DIE5,
STATE_VILE_DIE6,
STATE_VILE_DIE7,
STATE_VILE_DIE8,
STATE_VILE_DIE9,
STATE_VILE_HEAL1,
STATE_VILE_HEAL2,
STATE_VILE_HEAL3,
STATE_VILE_PAIN,
STATE_VILE_PAIN2,
STATE_VILE_RUN1,
STATE_VILE_RUN10,
STATE_VILE_RUN11,
STATE_VILE_RUN12,
STATE_VILE_RUN2,
STATE_VILE_RUN3,
STATE_VILE_RUN4,
STATE_VILE_RUN5,
STATE_VILE_RUN6,
STATE_VILE_RUN7,
STATE_VILE_RUN8,
STATE_VILE_RUN9,
STATE_VILE_STND,
STATE_VILE_STND2,
STATE_YKEY,
STATE_YKEY2,
STATE_YSKULL,
STATE_YSKULL2,
};

typedef struct
{
  bool               is_valid;         // false is used to mark the end of an array
  map_obj_state_id   cur_state_id;
  char               sprite_prefix[5]; // 4 + NULL
  int8_t             sprite_frame;
  int8_t             num_ticks;        // or -1, to indicate permanent cyclying
  int8_t             light_flash;      // 0 or 1
  char               action[50];       // The name of the doom function() that gets called each tick while in state
  map_obj_state_id   next_state_id;
  int16_t            misc1;            // extra param (unused?)
  int16_t            misc2;            // extra param (unused?)
} map_obj_state;

typedef struct
{
  int16_t              doomednum;
  map_obj_state const *normal_states;
  int16_t              spawn_health;
  map_obj_state const *see_states;
  int16_t              reaction_time;
  map_obj_state const *pain_states;
  int16_t              pain_chance;
  map_obj_state const *melee_states;
  map_obj_state const *missile_states;
  map_obj_state const *death_states;
  map_obj_state const *xdeath_states;
  int16_t              velocity;
  int16_t              radius;
  int16_t              height;
  int32_t              mass;
  int16_t              damage;
  uint32_t             flags;
  map_obj_state const *raise_states;
} map_obj_defn;

enum map_obj_meta_state_id
{
  META_STATE_NORMAL,
  META_STATE_SEE,
  META_STATE_PAIN,
  META_STATE_MELEE,
  META_STATE_MISSILE,
  META_STATE_DEATH,
  META_STATE_XDEATH,
  META_STATE_RAISE
};

class game;        // forward declaration
class episode_map; // forward declaration
class subsector;   // forward declaration
class sector;      // forward declaration

class map_object
{
public:
  map_object(vertex const *_map_position, float _facing_angle, map_obj_defn const *_defn);
  ~map_object();

  vertex const *get_map_position(void) const { return &map_position; }
  void set_subsector(subsector const *ss) { _subsector = ss; }
  subsector const *get_subsector(void) const { return _subsector; }
  sector const *get_sector(void) const;
 
  void tick(game *_game, episode_map *_map);

  void render_player_view(camera const *_camera, clipped_segment_projections *clipped_seg_projs) const;
  map_object_projection *project(camera const *_camera) const;

private:
  void change_to_meta_state(map_obj_meta_state_id new_meta_state_id);
  float get_rotation_angle(camera const *_camera) const;
  bool lookup_next_state(map_obj_state_id next_state_id, map_obj_meta_state_id *new_meta_state_id, map_obj_state const **new_state) const;

  map_obj_defn const     *defn;
  map_obj_meta_state_id   cur_meta_state_id;
  map_obj_state_id        cur_state_id;
  map_obj_state const    *cur_state;
  uint8_t                 cur_tick_count;
  int16_t                 health;
  sprite_animation const *cur_animation;

  vertex                  map_position;
  float                   facing_angle;
  int16_t                 velocity;

  subsector const *_subsector;
};

void map_object_tests(void);

extern map_obj_defn const *map_obj_being_defns[];
extern map_obj_defn const *map_obj_projectile_defns[];
extern map_obj_defn const *map_obj_inert_defns[];

#endif
